# Linux用户操作

## 1.用户介绍

Linux操作系统的用户体系非常灵活，这使得它成为了一个很好的多用户系统。它有三种类型的用户：超级用户（root），系统用户和常规用户。

1. **超级用户 (root)**： 在Linux系统中，超级用户是权限最高的用户，被称为根用户，也就是root用户。超级用户可以执行任何命令，包括系统设置、软件安装、用户和权限管理等。root用户的权限等同于Windows系统中的管理员权限。
2. **系统用户**： 系统用户主要是为了运行某些服务或者守护进程（daemon）而创建的。这些系统用户通常不会具有登录shell，也就是说，它们不能直接登录系统。例如，邮件系统会有一个名为 `mail` 的系统用户，网页服务器可能会有一个名为 `www` 或 `http` 的用户。
3. **常规用户**： 这些用户是进行日常工作的用户，他们可以登录系统并运行各种应用程序。但是，他们不能对系统进行修改，也不能访问其他用户的文件，除非这些文件被明确地赋予了访问权限。你在安装Linux系统后创建的第一个用户就是常规用户（也可以不创建），通常这个用户会被赋予使用sudo命令的权限，也就是说，这个用户可以执行一些需要root权限的命令。

在Linux系统中，每个用户都有一个唯一的用户ID（UID），系统内部通过UID来识别用户。UID 0通常被赋予root用户，UID 1-999一般为系统用户，1000以上的UID用于常规用户。

此外，Linux系统还采用了组（Group）的概念，每个用户都属于一个或多个组，这使得对文件或目录的权限管理更加灵活和方便。

## 2.用户管理

Linux 用户管理可以通过命令行进行，以下是一些常用的用户管理命令：

1. `useradd [options] username`：创建新的用户。例如 `useradd -m username` 将会创建一个新的用户，并创建用户的主目录。
2. `passwd username`：设置或修改用户的密码。
3. `userdel [options] username`：删除用户。例如 `userdel -r username` 将会删除用户以及用户的主目录。
4. `usermod [options] username`：修改用户的信息。例如 `usermod -l newname username` 将会修改用户的用户名。
5. `groups username`：显示用户所属的组。
6. `id username`：显示用户的 UID（用户 id）、GID（用户组 id）以及所属的组。
7. `su username`：切换到其他用户。例如 `su - username` 将会切换到用户，并加载用户的环境变量。
8. `whoami`：显示当前的用户名。
9. `who`：显示当前登录的所有用户。
10. `last`：显示系统的登录记录。

注意在使用这些命令时可能需要 root 权限，可以使用 `sudo` 命令获取 root 权限。例如 `sudo useradd username`。

以上仅为 Linux 用户管理的简单介绍，实际上 Linux 的用户管理还包括用户组管理，权限管理等更复杂的内容。

## 3.sudo说明

`sudo` 是 "superuser do" 的缩写，用于执行需要管理员权限的命令。在 Linux 中，出于安全考虑，通常推荐不要直接以管理员（root）身份登录系统，而是以普通用户身份登录，并在需要的时候通过 `sudo` 命令临时获取管理员权限。

`sudo` 的基本用法如下：

`sudo command`：以管理员权限执行指定的命令。例如 `sudo apt update` 将以管理员权限更新软件包列表。

`sudo -i` 或 `sudo -s`：开启新的以 root 权限的 shell。这将允许你连续执行需要 root 权限的命令，而不是每次都需要输入 `sudo`。

`sudo visudo`：编辑 sudoers 文件，这个文件定义了哪些用户可以使用 `sudo` 命令，以及他们可以执行的命令。

在执行 `sudo` 命令时，系统会要求你输入密码。这是出于安全考虑，防止未经授权的人使用 `sudo`。输入的密码不会显示在屏幕上。

注意，`sudo` 非常强大，但也可能非常危险。如果你不确定一个命令的作用，最好不要使用 `sudo` 执行它。在错误的情况下，使用 `sudo` 可能会导致系统崩溃或数据丢失。

## 4.免密码使用sudo

在某些情况下，你可能希望免密码使用 `sudo`。例如，某些自动化脚本可能需要 `sudo` 权限，但没有交互方式输入密码。在这种情况下，你可以编辑 `/etc/sudoers` 文件来实现这个目的。

以下是一种典型的配置方式：

1. 首先，打开终端。
2. 输入 `sudo visudo`，然后按回车。你可能需要输入你的密码。
3. 找到这样一行：`root    ALL=(ALL:ALL) ALL`。
4. 在这行下面，添加一行新的条目，替换 `yourusername` 为你的用户名：`yourusername    ALL=(ALL:ALL) NOPASSWD:ALL`。
5. 按 `Ctrl+X`，然后按 `Y` 然后回车，以保存并退出文件。

这样，你就可以在不需要密码的情况下使用 `sudo` 了。需要注意的是，这样做会有一定的安全风险，因为任何人只要获得了你的用户权限，就可以执行 `sudo` 命令。因此，除非你明确知道你在做什么，并了解其中的风险，否则不建议这样做。

## 5.最佳实践

`su`（Substitute User）命令通常用于在UNIX和Linux系统中切换当前用户身份到另一个用户。使用`su`命令时，建议遵循一些最佳实践来确保系统的安全和稳定性。

1. **使用`su -`来获取登录环境：** 当切换到其他用户时，使用带有减号`-`的`su -`命令，这样可以确保你获得该用户的登录环境，包括设置正确的环境变量和启动文件。例如：

   ```bash
   su - username
   ```

2. **避免以root用户运行：** 尽量避免使用`su`切换到root用户，除非绝对必要。因为root用户具有对系统的完全控制权，一个错误的命令可能会导致系统损坏或安全问题。

3. **使用`sudo`代替`su`：** 考虑使用`sudo`命令来执行特定的需要提升权限的命令，而不是完全切换到root用户。这样做可以提高安全性，因为`sudo`可以配置为只允许执行特定命令，并且所有的`sudo`操作都会被记录下来。

   ```bash
   sudo command_to_run
   ```

4. **限制`su`权限：** 在系统中限制哪些用户可以使用`su`来切换到root用户或其他用户。可以通过配置`/etc/pam.d/su`或`/etc/suauth`来实现。

5. **使用强密码：** 确保所有用户，特别是拥有`su`权限的用户，都使用强密码。这可以防止未经授权的用户通过猜测密码来获取提升的权限。

6. **监控使用`su`的登录尝试：** 定期检查系统日志文件（如`/var/log/auth.log`或`/var/log/secure`）以监控`su`的使用情况。这可以帮助你识别任何可疑的活动。

7. **了解用户环境的影响：** 当使用`su`而不带`-`时，当前用户的环境变量可能会保留下来，这可能会影响后续命令的执行。这是为什么通常推荐使用`su -`的原因。

8. **教育用户：** 对于需要使用`su`命令的用户，提供培训和指南，确保他们了解如何安全地使用这个命令。

9. **使用身份验证代理：** 如果可能，使用SSH密钥和身份验证代理（如`ssh-agent`）来管理认证，这样可以避免反复输入密码。

10. **配置账户锁定策略：** 如果有多次失败的登录尝试，设置账户锁定策略可以提高安全性。

在实施这些最佳实践时，考虑你的特定环境和需求，因为不同的系统和组织可能有不同的安全策略和配置要求。
