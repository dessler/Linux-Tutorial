# Linux权限操作

**特别注意，无论添加还是修改权限，请注意操作范围，不要把系统默认的那些目录或者文件权限修改了，尤其是在递归修改的时候，一定要确保范围。**

## 1.Umask

`umask` 是一个 Unix/Linux 的 shell 命令，用来设置文件创建时的默认权限。这是一个设置了用户文件和目录创建模式的掩码值。

在 Unix/Linux 系统中，当创建新的文件或目录时，系统会根据 umask 值来设置新文件或目录的默认权限。这个 umask 值通常是一个 4 位的八进制数，如 0022、0007 等。

umask 命令的使用格式为：`umask [选项]... [模式]`。

- 如果不带任何参数，`umask` 命令会显示当前的 umask 值。
- 如果带有模式参数，`umask` 命令会设置 umask 值为指定的模式。

一些常见的 umask 值：

- umask 0022：文件的默认权限是 644（rw-r--r--），目录的默认权限是 755（rwxr-xr-x）。
- umask 0007：文件的默认权限是 660（rw-rw----），目录的默认权限是 770（rwxrwx---）。
- umask 0077：文件的默认权限是 600（rw-------），目录的默认权限是 700（rwx------）。

需要注意的是，umask 是一个掩码值，它的作用是屏蔽掉（即禁用）某些权限，而不是直接设置权限。所以，要得到文件或目录的实际默认权限，需要用基础权限（通常是 777 对于目录，666 对于文件）减去 umask 值。

**正常Centos系统的umask是0022**，一般读法是022，第一个0会背省略，一般也不需要去修改。

## 2.Linux的权限介绍

在Linux系统中，每个文件和目录都有一个访问权限，用来保护数据的安全。这个权限分为三类，分别对应三种不同的用户：

1. 文件拥有者（User）：创建该文件或目录的用户。
2. 用户组（Group）：文件拥有者所在的用户组，用户组中的用户可以共享某些权限。
3. 其他用户（Other）：除了文件拥有者和用户组内的用户之外的其他用户。

每种用户都有以下三种权限：

1. 读取权限（Read）：用户可以读取文件的内容或列出目录的内容。用“r”表示，对应数值4。
2. 写入权限（Write）：用户可以修改文件的内容或在目录中创建和删除文件。用“w”表示，对应数值2。
3. 执行权限（Execute）：用户可以执行文件，或者进入和查看目录的内容。用“x”表示，对应数值1。

例如，如果一个文件的权限被设置为"755"，那么对应的权限是：

- 文件拥有者：7（即4+2+1）拥有读、写、执行权限
- 用户组：5（即4+0+1）拥有读、执行权限
- 其他用户：5（即4+0+1）拥有读、执行权限

可以使用`chmod`命令来改变文件或目录的权限，使用`chown`命令来改变文件或目录的所有者，使用`chgrp`命令来改变文件或目录的用户组。

## 3.Linux的特殊权限

在 Linux 中除了基本的读取（r）、写入（w）和执行（x）权限外，还有三种特殊权限：

1. SUID：Set User ID，设置用户标识位。当 SUID 位设置在一个可执行文件上时，那么运行这个文件的用户将拥有和文件所有者相同的权限。在权限设置中用`s`表示。
2. SGID：Set Group ID，设置组标识位。当 SGID 位设置在一个可执行文件上时，那么运行这个文件的用户将拥有和文件所在组相同的权限。在权限设置中也用`s`表示。此外，如果 SGID 设置在目录上，那么该目录下新建的文件的默认组将会是该目录的组，而不是用户的初始组。
3. Sticky Bit：粘滞位。主要用在目录上，设置后，目录下的文件只有文件的所有者才能删除，其他用户即使有写权限，也不能删除其他用户的文件。在权限设置中用`t`表示。

举例说明，假设某个文件的权限为`rwsr-sr-t`，这就表示该文件设置了 SUID、SGID 和 Sticky Bit 权限。

特殊权限的设置需要在`chmod`命令中使用以下对应的数字：

- SUID：4
- SGID：2
- Sticky Bit：1

例如，`chmod 4755 file` 将会给文件`file`设置 SUID 权限。

##  4. chattr和lsattr

`chattr` 和 `lsattr` 是 Linux 中两个用于处理文件和目录属性的命令。

1. `chattr` (Change Attribute) 命令：此命令用于改变文件或者目录的属性。这些属性包括是否可以修改文件内容或设置文件为只读，是否可以予以删除或重命名，是否可以将数据或元数据更新同步写入磁盘，是否可以对文件进行压缩，等等。

   基本格式为：`chattr [选项] [+-=] [mode] 文件或目录`

   其中，`+` 表示添加属性，`-` 表示移除属性，`=` 表示设置属性。

   例如，`chattr +i example.txt` 命令将 `example.txt` 文件设置为不可修改的，也就是说，文件内容无法更改，无法删除或重命名。

2. `lsattr` (List Attribute) 命令：此命令用于列出文件和目录的属性。与 `chattr` 命令相对应，这个命令可以查看文件或者目录的属性。

   基本格式为：`lsattr [选项] 文件或目录`

   例如，`lsattr example.txt` 命令将显示 `example.txt` 文件的属性。

这两个命令通常在保护系统文件时使用，比如你可以用 `chattr` 命令将一些重要的系统文件设置为只读，以防止被误修改或删除。