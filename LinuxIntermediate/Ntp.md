# NTP时间

## 1.什么是NTP

NTP，全称是Network Time Protocol，即网络时间协议。它是用来同步网络中各个计算机的时钟的协议，使得网络中的计算机可以有一个一致的时间。它能够提供精确到亚秒级的时间同步，并且可以在计算机之间自动进行时间校对，以消除时钟漂移。

NTP常用于银行、股票交易、航空、电信等需要精确时间的领域，也是网络服务如email、数据库等应用的重要组成部分。

## 2.为什么要进行NTP配置

进行NTP配置是为了保证网络中的所有设备能够同步到准确的时间，这对于许多应用和服务来说是非常重要的。

1. 数据一致性：许多系统和应用依赖时间戳来跟踪事件或数据的更改。如果时间不一致，可能会导致数据错误或冲突。
2. 日志分析和故障排查：如果网络中的设备时间不一致，分析日志和故障排查会变得复杂和困难，因为无法准确知道事件发生的顺序。
3. 安全性：许多安全协议和技术（如Kerberos或SSL）都依赖于准确的时间。如果时间不准确，可能会引发安全问题，或者导致服务无法正常运行。
4. 高精度应用：一些高精度应用（如科学研究、金融交易等）需要非常准确的时间同步。
5. 法规合规：某些行业（如医疗、金融等）有法规要求对事件的时间进行精确记录。

通过配置NTP，我们可以在网络中的所有设备上实现准确、一致的时间，从而提高系统的整体性能和可靠性。

## 3.NTP协议常用的2个软件

### 3.1 NTP

#### 3.1.1 如何使用NTP配置-客户端

NTP客户端的配置步骤可能会因操作系统的不同而略有差异，但基本流程大致相同。以下是在Linux系统下的一个基本配置步骤：

1. 安装NTP：首先你需要在你的系统上安装NTP服务。在大多数Linux发行版中，你可以使用包管理器来安装。例如在Ubuntu或Debian上，你可以使用如下命令来安装：

```
sudo apt install ntp
```

在CentOS或RHEL上，你可以使用如下命令来安装：

```
sudo yum install ntp
```

1. 修改NTP配置文件：安装完NTP服务后，你需要修改其配置文件来设置你的NTP服务器。配置文件通常位于/etc/ntp.conf。你可以使用文本编辑器打开并修改它。在文件中，找到以'server'开头的行，这些行定义了你的NTP服务器。你可以添加或修改这些行来设置你的NTP服务器。例如：

```
server ntp.example.com
```

这将设置ntp.example.com为你的NTP服务器。

1. 启动NTP服务：修改完配置文件后，你需要重启NTP服务来使更改生效。在Ubuntu或Debian上，你可以使用如下命令来重启NTP服务：

```
sudo systemctl restart ntp
```

在CentOS或RHEL上，你可以使用如下命令来重启NTP服务：

```
sudo systemctl restart ntpd
```

1. 验证NTP服务：最后，你可以使用ntpq命令来验证NTP服务是否正常工作。例如：

```
ntpq -p
```

这将显示你的NTP服务器的状态，如果一切正常，你应该能看到你的NTP服务器以及其延迟和抖动等信息。

以上就是在Linux系统下配置NTP客户端的基本步骤，其他系统如Windows或macOS的配置步骤可能会有所不同。

也可以直接使用ntpdate xxxx 直接同步服务器时间（要求对方服务器有ntp服务），除开ntp服务，还有chrony也可以用于时间同步。

#### 3.3.1.2 如何配置NTP配置-服务端

配置NTP服务器的步骤和配置客户端类似，但是有一些额外的设置需要考虑。以下是在Linux系统中作为NTP服务器的基本配置步骤：

1. 安装NTP：首先，你需要在服务器上安装NTP软件，这可以使用包管理器进行。在Ubuntu或Debian上，可以使用以下命令来安装：

```
sudo apt install ntp
```

在CentOS或RHEL上，可以使用以下命令来安装：

```
sudo yum install ntp
```

1. 配置NTP服务器：接下来，你需要编辑NTP的配置文件（通常在/etc/ntp.conf）来设置你的NTP服务器。在文件中，你需要设置至少一个上游的NTP服务器来同步你的服务器的时间。这可以通过添加"server"行来完成，例如：

```
server ntp.example.com
```

然后，你需要在配置文件中添加一个"restrict"行来设置哪些客户端可以访问你的NTP服务器，例如：

```
restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap
```

这将允许192.168.1.0/24网络中的客户端访问你的NTP服务器。

1. 启动NTP服务：保存并关闭配置文件后，你需要重启NTP服务来使更改生效。在Ubuntu或Debian上，你可以使用以下命令来重启NTP服务：

```
sudo systemctl restart ntp
```

在CentOS或RHEL上，你可以使用以下命令来重启NTP服务：

```
sudo systemctl restart ntpd
```

1. 配置防火墙：如果你的服务器有防火墙，你可能需要开放NTP使用的UDP端口123，以允许客户端访问你的NTP服务。
2. 验证NTP服务：最后，你可以使用ntpq命令来验证NTP服务是否正常工作。例如：

```
ntpq -p
```

这将显示你的NTP服务器的状态，如果一切正常，你应该能看到你的NTP服务器以及其延迟和抖动等信息。

以上就是在Linux系统中配置NTP服务器的基本步骤，其他系统的配置步骤可能会有所不同。

## 3.2 Chrony



问题：1.没有外部源的情况下如何做？

​            2.ntp是否需要高可用？

​            3.如何保证ntp时间不跳变？

## 5.最佳实践