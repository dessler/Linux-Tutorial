# DNS

## 1.什么是dns

DNS，全称是“Domain Name System”或者叫“域名系统”，是互联网的一种服务。它作为将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网，而不用去记住能够被机器直接读取的IP数串。

在互联网上，每个接入网络的设备都会被分配一个唯一的IP地址，你可以把它理解为互联网上的电话号码。当你想访问一个网站时，你的电脑实际上是向该网站服务器的IP地址发送请求。然而，IP地址是一串数字，对人类来说记忆起来相对困难。这时候，DNS就派上了用场，它的作用就是将这串数字的IP地址转换成更易于记忆的域名，如www.google.com等。

例如，当你在浏览器中输入www.google.com时，你的计算机会首先询问DNS服务器google.com的IP地址，然后DNS服务器会返回对应的IP地址给你的计算机，之后你的计算机才能通过该IP地址访问到google的网站。这个过程被称为DNS解析。

## 2.本地dns解析原理

域名系统（DNS）在互联网上起着至关重要的作用，它是将易于理解和记忆的域名转换为机器可理解的IP地址的系统。下面是本地DNS解析的基本原理：

1. 用户在浏览器中输入一个URL，例如www.example.com。
2. 计算机首先会查看本地DNS缓存，这是一个存储最近访问过的IP地址和域名映射的地方。如果找到了匹配的条目，那么就直接使用这个IP地址，解析过程在这里结束。
3. 如果在本地DNS缓存中没有找到匹配的条目，那么计算机会向配置的DNS服务器发送查询请求，查询www.example.com对应的IP地址。
4. DNS服务器会查看其记录，如果找到匹配的条目，就会返回对应的IP地址。
5. 如果DNS服务器没有该域名的记录，那么它会向其他的DNS服务器查询，这可能包括根服务器、顶级域（TLD）服务器和权威服务器。这个过程可能会涉及到几个回合的查询，直到找到正确的IP地址。
6. 一旦得到了IP地址，DNS服务器会将其返回给请求的计算机，并将这个域名和IP地址的映射存储在其本地缓存中，以备将来使用。
7. 计算机收到IP地址后，会将其存储在本地DNS缓存中，并使用这个IP地址去访问目标网站。
8. 浏览器连接到这个IP地址，并请求载入用户想要访问的网页。

通过这种方式，DNS解析将人类可读的域名转换为计算机可读的IP地址，让我们可以轻松地访问网站而不需要记住复杂的IP地址。

## 3.dns解析配置文件

`/etc/resolv.conf`文件是Linux和Unix系统中用于设置系统DNS解析的重要配置文件。主要由以下几种常见配置：

1. `nameserver`: 定义了系统将用于解析主机名的DNS服务器的IP地址。你可以指定多个nameserver。如果第一个服务器没有响应，系统将尝试使用第二个，以此类推。

   示例：

   ```
   nameserver 8.8.8.8
   nameserver 8.8.4.4
   ```

2. `domain`: 在只输入主机名而不是完全限定的域名（FQDN）时，将会添加该参数定义的域名。

   示例：

   ```
   domain example.com
   ```

3. `search`: 定义了在解析未完全限定的主机名时应搜索的域名列表。这些域名将逐个附加到主机名上，直到找到一个存在的主机名。

   示例：

   ```
   search example.com example.net
   ```

4. `sortlist`: 定义了地址排序规则，以优化处理可能返回多个地址的查询。

   示例：

   ```
   sortlist 130.155.160.0/255.255.240.0 130.155.0.0
   ```

5. `options`: 用于设置各种解析选项。

   示例：

   ```
   options ndots:5 timeout:15
   ```

   在这个例子中, `ndots:5` 表示如果一个域名中包含超过5个点，那么首先进行初始绝对查询，如果失败，再进行搜索列表查询。`timeout:15` 表示每个查询的超时时间为15秒。

以上就是`/etc/resolv.conf`文件中可能存在的配置项的解释。

## 4.搭建私有dns服务器

## 5.迭代和递归

在DNS查询过程中，有两种不同的查询方式：迭代查询（Iterative Query）和递归查询（Recursive Query）。这两种查询方式的主要区别在于DNS服务器如何回应客户端的查询请求。

1. 迭代查询：在迭代查询中，当客户端向DNS服务器查询时，如果该服务器没有存储查询的信息，它会将能够提供信息的其他服务器的地址返回给客户端，让客户端去那个服务器查找。也就是说，DNS服务器不会自己去查询，而是告诉客户端应该去哪里查找。
2. 递归查询：在递归查询中，当客户端向DNS服务器查询时，如果该服务器没有存储查询的信息，它会代表客户端去其他服务器查询，直到找到答案才返回给客户端。在这个过程中，客户端只需要等待最终结果，所有的查询工作都由DNS服务器完成。

简单来说，迭代查询中，客户端需要自己进行多次查询，而在递归查询中，所有的查询工作都由DNS服务器完成，客户端只需要等待最终结果。