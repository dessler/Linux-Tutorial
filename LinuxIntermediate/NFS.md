# NFS

## NFS基本介绍

NFS（Network File System）是一种分布式文件系统协议，用于在网络上共享文件和目录。它允许多个计算机系统通过网络访问和共享存储在远程文件服务器上的文件。以下是关于NFS的一些基本介绍：

1. 文件共享：NFS允许将远程文件系统挂载到本地计算机上，就像本地文件系统一样使用。这意味着可以通过网络透明地访问和操作远程文件，就像它们存在于本地计算机上一样。
2. 客户端和服务器：NFS系统由客户端和服务器组成。服务器负责存储和管理文件，并通过网络提供对这些文件的访问。客户端则是通过网络连接到服务器，并使用NFS协议访问和操作服务器上的文件。
3. 协议：NFS使用RPC（Remote Procedure Call，远程过程调用）协议来实现客户端和服务器之间的通信。客户端可以向服务器发送请求来读取、写入和执行其他文件操作。
4. 访问控制：NFS提供了一些访问控制机制来保护共享文件的安全性和隐私。可以通过设置权限、用户身份验证和访问控制列表等方式来限制对文件的访问。
5. 性能：NFS在文件共享方面具有良好的性能。它支持缓存和异步访问等机制，可以提高文件访问的效率，并减少网络传输的开销。
6. 可扩展性：NFS是一个可扩展的文件系统协议。它支持在多个服务器之间共享文件，并可以通过添加新的服务器来增加文件系统的容量和性能。

总的来说，NFS是一种用于在网络上共享文件和目录的协议。它提供了方便的远程文件访问机制，使不同计算机之间可以轻松共享和访问文件。

## NFS部署

### NFS服务端部署

### 1.安装nfs软件

```
 yum install nfs-utils -y
```

### 2.配置nfs

```
 #编辑文件
 vi /etc/exports
```

```
#根据需要配置需要共享的目录，保存退出
/home *(rw,sync,no_root_squash)
```

### 3.更新配置

```
 exportfs -r
```

### 4.启动服务

```
systemctl start nfs-server
systemctl enable nfs-server
#其实启动nfs服务的时候还会启动一个rpcbind的服务
```

## NFS客户端部署

### 1.部署nfs软件

```
yum install nfs-utils -y
#服务端和客户端其实需要安装的软件是一样的，只是服务端需要配置如何提高服务，而客户端不需要，和ntpd其实比较类似
```

### 2.创建测试目录

```
mkdir /test
```



### 3.测试挂载

```
#具体ip和路径以实际配置为准
mount -t nfs 192.168.0.239:/home /test
```

![image-20231204171937509](.NFS/image-20231204171937509.png)

## NFS配置参数

在NFS配置中，有一些常见的参数需要设置。以下是一些常用的NFS配置参数：

1. 导出目录（Export Directory）：指定要在NFS服务器上共享的目录路径。例如，`/home/nfs_share`。
2. 允许访问的客户端（Allowed Clients）：指定可以访问NFS共享的客户端地址。可以使用单个IP地址、子网掩码或者通配符来指定客户端。例如，`192.168.1.0/24`表示允许所有在192.168.1.0/24子网中的客户端访问。
3. 访问权限（Access Permissions）：指定对共享文件的访问权限。可以设置读取、写入和执行权限。例如，`rw`表示读写权限，`ro`表示只读权限。
4. 同步选项（Sync Option）：指定NFS服务器的同步选项，即文件写入的同步方式。可以设置为`sync`（同步写入）或`async`（异步写入）。同步写入会导致写入操作变慢但较安全，而异步写入会提高性能但可能会有数据丢失的风险。
5. 导出选项（Export Options）：提供其他选项来控制NFS共享的行为。例如，`no_root_squash`用于禁止将root用户映射到匿名用户，`no_subtree_check`用于禁用子树检查等。

这些参数通常需要在NFS服务器的配置文件中进行设置。在Linux系统上，NFS配置文件通常是`/etc/exports`。您可以使用文本编辑器打开此文件，并按照上述参数的格式进行设置。

请注意，具体的配置参数和格式可能会因操作系统和NFS版本而有所不同。建议在配置NFS时参考相关操作系统的文档或官方手册，以确保正确设置参数并满足您的需求。

## 经验之谈

1.挂载之前可用`showmonut` 命令测试服务器是否正常

2.测试环境是内网互通，如果有防火墙要注意规则放通

3.nfs服务端挂了，会导致nfs客户端负载异常，具体现象表现为：
2.1 负载很高，cpu使用率很低

2.2 `df`命令会卡住

解决办法：

1.强制卸载挂载的目录（客户端操作，不一定能重启）

2.重启，避免开机自动挂载nfs

3.如果无法修复，可使用一个假的ntpserver来临时恢复，然后取消挂载。